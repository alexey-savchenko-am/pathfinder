(()=>{"use strict";var t={902:(t,e,i)=>{i.d(e,{Z:()=>a});var s=i(81),n=i.n(s),r=i(645),o=i.n(r)()(n());o.push([t.id,"body {\n    position: relative;\n    box-sizing: border-box;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    background-color: black;\n}\n\n#board {\n    cursor: pointer;\n    background-color: black;\n}\n\n.coords {\n    position: fixed;\n    right: 50px;\n    top:50px;\n    font-size: 2rem;\n}",""]);const a=o},645:t=>{t.exports=function(t){var e=[];return e.toString=function(){return this.map((function(e){var i="",s=void 0!==e[5];return e[4]&&(i+="@supports (".concat(e[4],") {")),e[2]&&(i+="@media ".concat(e[2]," {")),s&&(i+="@layer".concat(e[5].length>0?" ".concat(e[5]):""," {")),i+=t(e),s&&(i+="}"),e[2]&&(i+="}"),e[4]&&(i+="}"),i})).join("")},e.i=function(t,i,s,n,r){"string"==typeof t&&(t=[[null,t,void 0]]);var o={};if(s)for(var a=0;a<this.length;a++){var h=this[a][0];null!=h&&(o[h]=!0)}for(var c=0;c<t.length;c++){var l=[].concat(t[c]);s&&o[l[0]]||(void 0!==r&&(void 0===l[5]||(l[1]="@layer".concat(l[5].length>0?" ".concat(l[5]):""," {").concat(l[1],"}")),l[5]=r),i&&(l[2]?(l[1]="@media ".concat(l[2]," {").concat(l[1],"}"),l[2]=i):l[2]=i),n&&(l[4]?(l[1]="@supports (".concat(l[4],") {").concat(l[1],"}"),l[4]=n):l[4]="".concat(n)),e.push(l))}},e}},81:t=>{t.exports=function(t){return t[1]}},379:t=>{var e=[];function i(t){for(var i=-1,s=0;s<e.length;s++)if(e[s].identifier===t){i=s;break}return i}function s(t,s){for(var r={},o=[],a=0;a<t.length;a++){var h=t[a],c=s.base?h[0]+s.base:h[0],l=r[c]||0,d="".concat(c," ").concat(l);r[c]=l+1;var u=i(d),m={css:h[1],media:h[2],sourceMap:h[3],supports:h[4],layer:h[5]};if(-1!==u)e[u].references++,e[u].updater(m);else{var _=n(m,s);s.byIndex=a,e.splice(a,0,{identifier:d,updater:_,references:1})}o.push(d)}return o}function n(t,e){var i=e.domAPI(e);i.update(t);return function(e){if(e){if(e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap&&e.supports===t.supports&&e.layer===t.layer)return;i.update(t=e)}else i.remove()}}t.exports=function(t,n){var r=s(t=t||[],n=n||{});return function(t){t=t||[];for(var o=0;o<r.length;o++){var a=i(r[o]);e[a].references--}for(var h=s(t,n),c=0;c<r.length;c++){var l=i(r[c]);0===e[l].references&&(e[l].updater(),e.splice(l,1))}r=h}}},569:t=>{var e={};t.exports=function(t,i){var s=function(t){if(void 0===e[t]){var i=document.querySelector(t);if(window.HTMLIFrameElement&&i instanceof window.HTMLIFrameElement)try{i=i.contentDocument.head}catch(t){i=null}e[t]=i}return e[t]}(t);if(!s)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");s.appendChild(i)}},216:t=>{t.exports=function(t){var e=document.createElement("style");return t.setAttributes(e,t.attributes),t.insert(e,t.options),e}},565:(t,e,i)=>{t.exports=function(t){var e=i.nc;e&&t.setAttribute("nonce",e)}},795:t=>{t.exports=function(t){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var e=t.insertStyleElement(t);return{update:function(i){!function(t,e,i){var s="";i.supports&&(s+="@supports (".concat(i.supports,") {")),i.media&&(s+="@media ".concat(i.media," {"));var n=void 0!==i.layer;n&&(s+="@layer".concat(i.layer.length>0?" ".concat(i.layer):""," {")),s+=i.css,n&&(s+="}"),i.media&&(s+="}"),i.supports&&(s+="}");var r=i.sourceMap;r&&"undefined"!=typeof btoa&&(s+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(r))))," */")),e.styleTagTransform(s,t,e.options)}(e,t,i)},remove:function(){!function(t){if(null===t.parentNode)return!1;t.parentNode.removeChild(t)}(e)}}}},589:t=>{t.exports=function(t,e){if(e.styleSheet)e.styleSheet.cssText=t;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(t))}}}},e={};function i(s){var n=e[s];if(void 0!==n)return n.exports;var r=e[s]={id:s,exports:{}};return t[s](r,r.exports,i),r.exports}i.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return i.d(e,{a:e}),e},i.d=(t,e)=>{for(var s in e)i.o(e,s)&&!i.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:e[s]})},i.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),i.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),(()=>{var t;i.g.importScripts&&(t=i.g.location+"");var e=i.g.document;if(!t&&e&&(e.currentScript&&(t=e.currentScript.src),!t)){var s=e.getElementsByTagName("script");if(s.length)for(var n=s.length-1;n>-1&&!t;)t=s[n--].src}if(!t)throw new Error("Automatic publicPath is not supported in this browser");t=t.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),i.p=t})(),i.nc=void 0,(()=>{class t{constructor(){if(t.instance)return t.instance;this.tileSize=75,t.instance=this}get getTileSize(){return this.tileSize}}function e(){this._vectors={}}function s(t,e){this._row=t,this._col=e}e.prototype={get:function(t){return this._vectors[t.getString]},add:function(t,e){this._vectors[t.getString]=e},remove:function(t){const e=t.getString;this.contains(e)&&delete this._vectors[e]},contains:function(t){const e=t.getString;return this._vectors.hasOwnProperty(e)},forEach:function(t){for(const e in this._vectors)this._vectors.hasOwnProperty(e)&&t(this._vectors[e])}},s.prototype={get getRow(){return this._row},get getCol(){return this._col},get getString(){return`(${this._row};${this._col})`},hashCode:function(){return`${this._row}-${this._col}`},equalsTo:function(t){return t.getRow===this._row&&t.getCol===this._col},clone:function(){return new s(this._row,this._col)},round:function(){return new s(Math.ceil(this._row),Math.ceil(this._col))},add:function(t){return new s(this._row+t.getRow,this._col+t.getCol)},sub:function(t){return new s(this._row-t.getRow,this._col-t.getCol)},distance:function(t){return Math.abs(this._row-t.getRow)+Math.abs(this._col-t.getCol)},intersect:function(t){return 0!==t.row*this._col-t._col*this._row},left:function(){return new s(Math.ceil(this._row),Math.ceil(this._col-1))},right:function(){return new s(Math.ceil(this._row),Math.ceil(this._col+1))},bottom:function(){return new s(Math.ceil(this._row+1),Math.ceil(this._col))},top:function(){return new s(Math.ceil(this._row-1),Math.ceil(this._col))},topLeft:function(){return new s(Math.ceil(this._row-1),Math.ceil(this._col-1))},topRight:function(){return new s(Math.ceil(this._row-1),Math.ceil(this._col+1))},bottomLeft:function(){return new s(Math.ceil(this._row+1),Math.ceil(this._col-1))},bottomRight:function(){return new s(Math.ceil(this._row+1),Math.ceil(this._col+1))}};class n{constructor(e,i,s,n){this._position=e,this.width=i,this.height=s,this.settings=new t,this._tileSize=this.settings.getTileSize,this._x=e.getCol*this._tileSize,this._y=e.getRow*this._tileSize,this._centerX=(this._tileSize-this.width)/2+this._x,this._centerY=(this._tileSize-this.height)/2+this._y,this._children=[],this._inputHandler=n,this._selected=!1,this._isMarkAsDeleted=!1}get childrenCount(){return this._children.length}get getPosition(){return this._position}get position(){return this._position}get left(){return this._x}get top(){return this._y}get right(){return this._x+this.width}get bottom(){return this._y+this.height}getAndRemoveChild(){if(0===this._children.length)return null;const t=this._children[0];return this._children.shift(),t}setPosition(t){this._position=t.clone(),this._x=t.getCol*this._tileSize,this._y=t.getRow*this._tileSize,this._centerX=(this._tileSize-this.width)/2+this._x,this._centerY=(this._tileSize-this.height)/2+this._y}select(){this._selected=!0}deselect(){this._selected=!1}appendChild(t){this._children.push(t)}removeChild(t){this._children=this._children.filter((e=>t!==e))}getDelta(t,e,i,s){return{dx:i-t,dy:s-e}}handleInputEvent(){if(!this._inputHandler)return;const t=this._inputHandler.handle(this);t&&t.execute()}moveTo(t,e){}draw(t){}}const r=i.p+"images/landscape.png",o=i.p+"images/hero.png",a=i.p+"images/coin.svg",h=i.p+"images/candle.png",c=i.p+"images/light.png",l=i.p+"images/gnome.png";const d=new class{constructor(){this.toLoad={landscape:r,hero:o,coin:a,candle:h,light:c,gnome:l},this.toLoadSounds={coin:"/assets/sound/coin.wav",move:"/assets/sound/move.wav",break:"/assets/sound/break.mp3",pickup:"/assets/sound/pickup.mp3"},this.images={},this.sounds={},Object.keys(this.toLoad).forEach((t=>{const e=new Image;e.src=this.toLoad[t],this.images[t]={image:e,isLoaded:!1},e.onload=()=>{this.images[t].isLoaded=!0}}));const t=new window.AudioContext;Object.keys(this.toLoadSounds).forEach((e=>{fetch(this.toLoadSounds[e]).then((t=>t.arrayBuffer())).then((e=>t.decodeAudioData(e))).then((t=>{this.sounds[e]=t})).catch((t=>{}))}))}};const u=new class{constructor(){this.audioContext=new(window.AudioContext||window.webkitAudioContext),this.isPlaying=!1}playSound(t){if(!t)return;const e=this.audioContext.createBufferSource();e.buffer=t,e.connect(this.audioContext.destination),e.onended=()=>{this.isPlaying=!1},e.start(),this.isPlaying=!0,setTimeout((()=>{this.isPlaying&&(e.stop(),this.isPlaying=!1)}),1e3)}};const m=new class{_callbacks=[];_nextId=0;emit(t,e){this._callbacks.forEach((i=>{i.eventName===t&&i.callback(e)}))}on(t,e,i){return this.nextId++,this._callbacks.push({id:this._nextId,eventName:t,caller:e,callback:i}),this._nextId}off(t){this._callbacks=this._callbacks.filter((e=>e.id!==t))}unsubscribe(t){this._callbacks=this._callbacks.filter((e=>e.caller!==t))}};class _{constructor({resource:t,top:e,left:i,right:s,bottom:n}){this._resource=t}draw(t,e,i,s,n){this._resource.isLoaded&&t.drawImage(this._resource.image,e,i,s,n)}}class f extends _{constructor({resource:t,frameSize:e,hFrames:i,vFrames:n}){super({resource:t}),this._frameSize=e??new s(16,16),this._hFrames=i,this._vFrames=n,this._frameMap=new Map,this.buildFrameMap()}buildFrameMap(){let t=0;for(let e=0;e<this._vFrames;e++)for(let i=0;i<this._hFrames;i++)this._frameMap.set(t,new s(this._frameSize.getRow*i,this._frameSize.getCol*e)),t++}draw(t,e,i,s,n,r=null){if(!this._resource.isLoaded)return;r||(r=0);const o=this._frameMap.get(r);t.drawImage(this._resource.image,o.getRow,o.getCol,this._frameSize.getRow,this._frameSize.getCol,e,i,s,n)}}function p(t,e){const i=Array.from({length:t},(()=>Array(e).fill(1)));i[1][1]=0,g(i,1,1);for(let s=0;s<t;s++)for(let t=0;t<1;t++){const t=Math.floor(Math.random()*e);1===i[s][t]&&0===i[s][t-1]&&0===i[s][t+1]&&(i[s][t]=0)}for(let s=0;s<e;s++)for(let e=0;e<10;e++){const e=Math.floor(Math.random()*t);e>0&&e<t-1&&1===i[e][s]&&0===i[e-1][s]&&0===i[e+1][s]&&(i[e][s]=0)}return i.flat()}function g(t,e,i){const s=[[0,2],[2,0],[0,-2],[-2,0]];!function(t){for(let e=t.length-1;e>0;e--){const i=Math.floor(Math.random()*(e+1));[t[e],t[i]]=[t[i],t[e]]}}(s);for(const[n,r]of s){const s=e+n,o=i+r;s>=0&&s<t.length&&o>=0&&o<t[0].length&&1===t[s][o]&&(t[s][o]=0,t[e+n/2][i+r/2]=0,g(t,s,o))}}function w(t,e,i,s=0){const n=t,r=e,o=i,a=s;return{getMovementCost:function(){return n},getIsPassable:function(){return r},draw:function(t,e,i,s,n){o.draw(t,e,i,s,n,a)}}}const y="dark",T="light";class v extends n{constructor(t,{darkTerrain:e,lightTerrain:i}){super(t,75,75),this._isSelected=!1,this._darkTerrain=e,this._lightTerrain=i,this._displayMode=y}get terrain(){return this._displayMode===y?this._darkTerrain:this._lightTerrain}setTerrain({darkTerrain:t,lightTerrain:e}){this._darkTerrain=t,this._lightTerrain=e}get isSelected(){return this._isSelected}select(){this._isSelected=!0}deselect(){this._isSelected=!1}set displayMode(t){this._displayMode=t}isCollideWith(t){return this.left<t.right&&this.right>t.left&&this.top<t.bottom&&this.bottom>t.top}update(t){this._children.forEach((e=>{e.update(t),e._isCollected&&this.removeChild(e)}))}draw(t){this._displayMode===y?this._darkTerrain.draw(t,this._x,this._y,this.width,this.height):(this._lightTerrain.draw(t,this._x,this._y,this.width,this.height),this._children.forEach((e=>e.draw(t)))),this._isSelected&&(t.fillStyle="rgba(255, 0, 0, 0.2)",t.fillRect(this._x,this._y,this.width,this.height))}}class S extends n{constructor(t,e,i,s){super(t,e,i),this._animation=s,m.on("HERO_POSITION",this,(t=>{!this._isMarkAsDeleted&&this.getPosition.equalsTo(t)&&(this._isMarkAsDeleted=!0,u.playSound(d.sounds.coin))}))}update(t){}draw(t){this._isMarkAsDeleted||this._animation.draw(t,this._centerX,this._centerY,this.width,this.height)}}const b={duration:600,frames:[{time:0,frame:0},{time:100,frame:1},{time:200,frame:2},{time:300,frame:3},{time:400,frame:4},{time:500,frame:5}]},M={duration:1600,frames:[{time:0,frame:0},{time:100,frame:1},{time:200,frame:2},{time:300,frame:3},{time:400,frame:4},{time:500,frame:5},{time:500,frame:5},{time:600,frame:6},{time:700,frame:7},{time:800,frame:8},{time:900,frame:9},{time:1e3,frame:10},{time:1100,frame:11},{time:1200,frame:12},{time:1300,frame:13},{time:1400,frame:14},{time:1500,frame:15}]};class P{constructor(t,e){this._sprite=t,this._currentTime=0,this._animationPattern=e}setAnimationPattern(t){this._animationPattern!==t&&(this._animationPattern=t)}get frame(){if(!this._animationPattern)return 0;const{frames:t}=this._animationPattern;for(let e=t.length-1;e>=0;e--)if(this._currentTime>=t[e].time)return t[e].frame;throw"Time is before the first keyframe"}update(t){this._currentTime+=t,this._currentTime>=this._animationPattern.duration&&(this._currentTime=0)}draw(t,e,i,s,n){this._sprite.draw(t,e,i,s,n,this.frame)}}class k extends n{constructor(t,e,i,s){super(t,e,i),this._animation=s}update(t){}draw(t){this._animation.draw(t,this._centerX,this._centerY,this.width,this.height)}}class C{constructor(){const i=new t;this._tileSize=i.tileSize,this._tileMap=new e;const n=new f({resource:d.images.landscape,frameSize:new s(335,334),hFrames:2,vFrames:2});this.darkWallTerrain=w(1,!1,n,1),this.lightWallTerrain=w(1,!1,n,0),this.darkSandTerrain=w(1,!0,n,3),this.lightSandTerrain=w(1,!0,n,2);const r=new f({resource:d.images.coin,frameSize:new s(256,324),hFrames:6,vFrames:6});this._coinAnimation=new P(r,b);const o=new f({resource:d.images.light,frameSize:new s(150,150),hFrames:4,vFrames:4});this._lightAnimation=new P(o,M),m.on("OBJECT_THROWING",this,(({object:t,position:e})=>{const i=this.getIntersectingTile(e);i&&!i.terrain.getIsPassable()&&(t.stopThrowing(),this.setSandTerrain(i),u.playSound(d.sounds.break))})),m.on("HERO_POSITION",this,(t=>{this.deselectTiles([t])}))}getIntersectingTile(t){return this._tileMap.get(t.round())}setWallTerrain(t){t.setTerrain({darkTerrain:this.darkWallTerrain,lightTerrain:this.lightWallTerrain})}setSandTerrain(t){t.setTerrain({darkTerrain:this.darkSandTerrain,lightTerrain:this.lightSandTerrain})}getTile=t=>this._tileMap.get(t.round());getTileByCoordinates(t,e,i){let n=Math.floor(e/this._tileSize),r=Math.floor(t/this._tileSize);return i&&(n+=Math.abs(i.getRow),r+=Math.abs(i.getCol)),this.getTile(new s(n,r))}initialize(t,e){const i=p(e,t);for(let n=0;n<e;n++)for(let e=0;e<t;e++){const r=n*t+e;let o={darkTerrain:this.darkSandTerrain,lightTerrain:this.lightSandTerrain};1===i[r]&&(o={darkTerrain:this.darkWallTerrain,lightTerrain:this.lightWallTerrain});const a=new s(n,e),h=new v(a,o);this._tileMap.add(a,h),this.addRandomCoin(h)}this.addRandomLights(t,e)}addRandomLights(t,e){for(let i=0;i<5;i++){let i=null,n=null;do{i=new s(Math.floor(Math.random()*e),Math.floor(Math.random()*t)),n=this._tileMap.get(i)}while(n.childrenCount>0||!n.terrain.getIsPassable());n.appendChild(new k(i,75,75,this._lightAnimation))}}addRandomCoin(t){if(t.terrain.getIsPassable()){Math.random()<=.1&&t.appendChild(new S(t.position,40,50,this._coinAnimation))}}selectTiles(t){t.forEach((t=>{const e=this._tileMap.get(t);e&&!e.isSelected&&e.select()}))}deselectTiles(t){t.forEach((t=>{const e=this._tileMap.get(t);e&&e.isSelected&&e.deselect()}))}update(t){this._coinAnimation.update(t),this._lightAnimation.update(t),this._tileMap.forEach((e=>{e.update(t)}))}highLightTilesAround(t,e){const i=function(t,e,i=3){const s=[],n=[],r=[{position:e,distance:0}];for(;r.length>0;){const{position:e,distance:o}=r.shift();if(!(o>i)&&-1===n.indexOf(e)){const i=t.get(e);if(!i)continue;n.push(e),s.push(t.get(e)),i.terrain.getIsPassable()&&(r.push({position:e.top(),distance:o+1}),r.push({position:e.bottom(),distance:o+1}),r.push({position:e.left(),distance:o+1}),r.push({position:e.right(),distance:o+1}),r.push({position:e.top().left(),distance:o+1}),r.push({position:e.top().right(),distance:o+1}),r.push({position:e.bottom().left(),distance:o+1}),r.push({position:e.bottom().right(),distance:o+1}))}}return s}(this._tileMap,t,e);for(const t of i)t.displayMode=T}draw(t,e){e&&this.highLightTilesAround(e.position.round(),2),this._tileMap.forEach((e=>{e._children.some((t=>t instanceof k))&&this.highLightTilesAround(e.position,1),e.draw(t),e.displayMode=y}))}}const x="LEFT",I="RIGHT",R="DOWN";class E{constructor(t){this._mouseState={isLeftPressed:!1,isRightPressed:!1,coordinates:{x:0,y:0}},this._keyState={LEFT:!1,RIGHT:!1,UP:!1,DOWN:!1},this._canvas=t,this.handleMouseDown=this.handleMouseDown.bind(this),this.handleMouseUp=this.handleMouseUp.bind(this),this.updateKeysState=this.updateKeysState.bind(this),this._canvas.addEventListener("mousedown",this.handleMouseDown),this._canvas.addEventListener("mouseup",this.handleMouseUp),document.addEventListener("keydown",this.updateKeysState),document.addEventListener("keyup",this.updateKeysState)}updateKeysState(t){switch(t.code){case"KeyA":case"ArrowLeft":this._keyState[x]="keydown"===t.type;break;case"KeyW":case"ArrowUp":this._keyState.UP="keydown"===t.type;break;case"KeyD":case"ArrowRight":this._keyState[I]="keydown"===t.type;break;case"KeyS":case"ArrowDown":this._keyState[R]="keydown"===t.type;break;default:this._keyState[t.code]="keydown"===t.type}}handleMouseDown(t){0===t.button?this._mouseState.isLeftPressed=!0:2===t.button&&(this._mouseState.isRightPressed=!0),this.updateMouseCoordinates(t)}handleMouseUp(t){(0===t.button||2===t.button)&&(this._mouseState.isLeftPressed=!1),this.updateMouseCoordinates(t)}handle(t){}isPressed(t){return this._keyState[t]}updateMouseCoordinates(t){const e=this._canvas.getBoundingClientRect(),i=Math.floor(t.x-e.left),s=Math.floor(t.y-e.top);this._mouseState.coordinates={x:i,y:s}}}function A(t,e){return{execute:function(){t.moveSelectedChildToVector(e)},undo:function(){}}}const L="up",z="down",D="left",O="right";class F extends n{constructor(t,e,i,s,n,r){super(i,s,n,r),this._destinationQueue=[],this._isMoving=!1,this._sprite=t,this._patterns=e,this._animation=new P(t,e.stayDownPattern),this._prevPosition=i.clone(),this._currentDirection=z,this._inventory=[],m.on("HERO_POSITION",this,(()=>{}))}pickUpItem(t){this._currentDirection=L,this._inventory.push(t),u.playSound(d.sounds.pickup)}get inventory(){return this._inventory}moveToTile(t){this.moveTo(t.getCol*this._tileSize,t.getRow*this._tileSize)}cancelMoving(){this._isMoving=!1,this._destinationQueue=[]}moveTo(t,e){this._isMoving=!0,t=Math.floor(t/this._tileSize)*this._tileSize,e=Math.floor(e/this._tileSize)*this._tileSize;const i=this._destinationQueue.length>0?this._destinationQueue[this._destinationQueue.length-1]:{x:this._x,y:this._y},s=this.getDelta(i.x,i.y,t,e),n=Math.atan2(s.dy,s.dx),r=this.radiansToDirection(n);this._destinationQueue.push({x:t,y:e,angle:n,direction:r})}radiansToDirection(t){var e=t*(180/Math.PI);return e>=-45&&e<45?O:e>=45&&e<135?z:e>=135&&e<=180||e>=-180&&e<-135?D:e>=-135&&e<-45?L:void 0}frame(t){if(this._animation.update(t),0===this._destinationQueue.length){switch(this._currentDirection){case z:this._animation.setAnimationPattern(this._patterns.stayDownPattern);break;case L:this._animation.setAnimationPattern(this._patterns.stayUpPattern);break;case D:this._animation.setAnimationPattern(this._patterns.stayLeftPattern);break;case O:this._animation.setAnimationPattern(this._patterns.stayRightPattern)}return}m.emit("HERO_POSITION",this._position);let e=this._destinationQueue[0];switch(this._currentDirection=e.direction,e.direction){case z:this._animation.setAnimationPattern(this._patterns.walkDownPattern);break;case L:this._animation.setAnimationPattern(this._patterns.walkUpPattern);break;case D:this._animation.setAnimationPattern(this._patterns.walkLeftPattern);break;case O:this._animation.setAnimationPattern(this._patterns.walkRightPattern)}const i=this.getDelta(this._x,this._y,e.x,e.y);if(Math.sqrt(i.dx*i.dx+i.dy*i.dy)<5)return this._destinationQueue.shift(),void(0===this._destinationQueue.length&&(this._isMoving=!1));const n=this._x+5*Math.cos(e.angle),r=this._y+5*Math.sin(e.angle);this._prevPosition=this._position.clone();const o=new s(r/this._tileSize,n/this._tileSize);this.setPosition(o),this._x=n,this._y=r}draw(t){this._animation.draw(t,this._centerX,this._centerY,this.width,this.height),this._selected&&(t.beginPath(),t.arc(this._x+this.width/2,this._y-5,5,0,2*Math.PI,!1),t.fillStyle="yellow",t.fill(),t.lineWidth=2,t.strokeStyle="black",t.stroke(),t.closePath())}}class N extends n{constructor(t,e,i){super(t,e,i),this._sprite=new _({resource:d.images.candle}),this._isThrowing=!1,this._throwDirection=null}get isThrown(){return this._isThrowing}throwTowards(t){this._isThrowing=!0,this._throwDirection=t}stopThrowing(){this._isThrowing=!1,this._throwDirection=null}update(t){if(this._isThrowing){const t=this.getPosition.add(this._throwDirection);this.setPosition(t),m.emit("OBJECT_THROWING",{object:this,position:t})}}draw(t,e){switch(e){case z:this._sprite.draw(t,this._centerX,this._centerY+10,this.width,this.height);break;case L:this._isThrowing&&this._sprite.draw(t,this._centerX,this._centerY+10,this.width,this.height);break;case D:this._sprite.draw(t,this._centerX-5,this._centerY+14,this.width,this.height);break;case O:this._sprite.draw(t,this._centerX+5,this._centerY+14,this.width,this.height)}}}const U={duration:100,frames:[{time:0,frame:2}]},j={duration:100,frames:[{time:0,frame:10}]},H={duration:100,frames:[{time:0,frame:7}]},W={duration:100,frames:[{time:0,frame:14}]},B={duration:400,frames:[{time:0,frame:2},{time:100,frame:1},{time:200,frame:2},{time:300,frame:3}]},K={duration:400,frames:[{time:0,frame:14},{time:100,frame:13},{time:200,frame:14},{time:300,frame:15}]},Q={duration:400,frames:[{time:0,frame:10},{time:100,frame:9},{time:200,frame:10},{time:300,frame:11}]},$={duration:400,frames:[{time:0,frame:6},{time:100,frame:5},{time:200,frame:6},{time:300,frame:7}]};const X={duration:100,frames:[{time:0,frame:23}]},Y={duration:100,frames:[{time:0,frame:9}]},q={duration:100,frames:[{time:0,frame:0}]},Z={duration:100,frames:[{time:0,frame:28}]},G={duration:600,frames:[{time:0,frame:18},{time:100,frame:19},{time:200,frame:20},{time:300,frame:21},{time:400,frame:22},{time:500,frame:23}]},J={duration:600,frames:[{time:0,frame:27},{time:100,frame:28},{time:200,frame:29},{time:300,frame:30},{time:400,frame:31},{time:500,frame:32}]},V={duration:900,frames:[{time:0,frame:9},{time:100,frame:10},{time:200,frame:11},{time:300,frame:12},{time:400,frame:13},{time:500,frame:14},{time:600,frame:15},{time:700,frame:16},{time:800,frame:17}]},tt={duration:900,frames:[{time:0,frame:0},{time:100,frame:1},{time:200,frame:2},{time:300,frame:3},{time:400,frame:4},{time:500,frame:5},{time:600,frame:6},{time:700,frame:7},{time:800,frame:8}]};var et=i(379),it=i.n(et),st=i(795),nt=i.n(st),rt=i(569),ot=i.n(rt),at=i(565),ht=i.n(at),ct=i(216),lt=i.n(ct),dt=i(589),ut=i.n(dt),mt=i(902),_t={};_t.styleTagTransform=ut(),_t.setAttributes=ht(),_t.insert=ot().bind(null,"head"),_t.domAPI=nt(),_t.insertStyleElement=lt();it()(mt.Z,_t);mt.Z&&mt.Z.locals&&mt.Z.locals;const ft=document.getElementById("board"),pt=ft.getContext("2d"),gt=document.getElementsByClassName("coords")[0];pt.imageSmoothingEnabled=!1,ft.addEventListener("mousemove",(t=>{let e=ft.getBoundingClientRect();const i=Math.floor(t.x-e.left),s=Math.floor(t.y-e.top);gt.innerText=`${i};${s}`})),document.addEventListener("contextmenu",(function(t){t.preventDefault()}));const wt=new class extends E{constructor(t){super(t)}handle(t){return this._mouseState.isRightPressed?(this._mouseState.isRightPressed=!1,function(t,e,i){let s,n;return{execute:function(){s=t.getRow,n=t.getCol,t.moveSelectedChildTo(e,i)},undo:function(){t.moveSelectedChildTo(s,n)}}}(t,this._mouseState.coordinates.x,this._mouseState.coordinates.y)):this._mouseState.isLeftPressed?(this._mouseState.isLeftPressed=!1,function(t,e,i){return{execute:function(){t.selectHero(e,i)},undo:function(){t.deselect(e,i)}}}(t,this._mouseState.coordinates.x,this._mouseState.coordinates.y)):this.isPressed("UP")?A(t,new s(-1,0)):this.isPressed(R)?A(t,new s(1,0)):this.isPressed(x)?A(t,new s(0,-1)):this.isPressed(I)?A(t,new s(0,1)):this.isPressed("KeyE")?(this._keyState.KeyE=!1,function(t){return{execute:function(){t.pickupOrThrowItem()},undo:function(){}}}(t)):null}}(ft),yt=new class extends E{constructor(t){super(t)}handle(t){return null}}(ft),Tt=new class extends n{constructor(){super(new s(0,0)),m.on("HERO_POSITION",this,(t=>{let e=5-t.getRow,i=8-t.getCol;e>0&&(e=0),i>0&&(i=0),e<-10&&(e=-10),i<-16&&(i=-16),this.setPosition(new s(e,i))}))}},vt=new class extends n{constructor(t,e,i,n){super(new s(0,0),i,n,e),this._camera=t,this._widthInTiles=i,this._heightInTiles=n,this._selectedChild=null,this._tiles=new C,this._score=0,m.on("COIN_COLLECTED",this,(()=>{this._score++}))}appendChild(t){const e=t.getPosition;let i=this._tiles.getTile(e),n=e;for(;!i.terrain.getIsPassable();)i=this._tiles.getTile(n),n=new s(e.getRow,e.getCol+1);t.setPosition(n),super.appendChild(t)}handleInputEvents(){this.handleInputEvent(),this._children.forEach((t=>t.handleInputEvent()))}generateMaze=()=>this._tiles.initialize(this._widthInTiles,this._heightInTiles);selectHero(t,e){const i=this._tiles.getTileByCoordinates(t,e,this._camera.getPosition);for(let t of this._children)t.deselect(),t.position.equalsTo(i.position)&&(this._selectedChild=t,t.select())}pickupOrThrowItem(){const t=this._selectedChild;if(!t)return;if(0!==t.inventory.length)return void t.throwObject();const e=this._tiles.getTile(t.position);if(0===e.childrenCount)return;const i=e.getAndRemoveChild();i&&t.pickUpItem(i)}moveSelectedChildToVector(t){if(!this._selectedChild||this._selectedChild._isMoving)return;const e=this._selectedChild.getPosition.add(t),i=this._tiles.getTile(e);i&&i.terrain.getIsPassable()&&this._selectedChild.moveToTile(e)}moveSelectedChildTo(t,e){if(!this._selectedChild||this._selectedChild._isMoving)return;const i=this._camera.getPosition;let n=this._tiles.getTileByCoordinates(t,e,i);const r=function(t,e,i,n,r){function o(t,e){this._parent=null,this._row=t,this._col=e,this._cost=0,this._heuristic=0,this.getCommonCost=()=>this._cost+this._heuristic}const a=[],h=[],c=new o(t.getRow,t.getCol);for(a.push(c);a.length>0;){let t=a[0],i=0;for(let e=1;e<a.length;e++)a[e].getCommonCost()<t.getCommonCost()&&(t=a[e],i=e);a.splice(i,1),h.push(t);const s=u(t);if(t._row===e.getRow&&t._col===e.getCol)return d(t);for(let i of s)h.some((t=>t._row===i._row&&t._col===i._col))||(a.some((t=>t._row===i._row&&t._col===i._col))||a.push(i),i._cost=t._cost+1,i._heuristic=(l=i,Math.abs(l._row-e.getRow)+Math.abs(l._col-e.getCol)),i._parent=t)}var l;function d(t){let e=[],i=t;for(;i;)e.push(new s(i._row,i._col)),i=i._parent;return e=e.reverse(),e}function u(t){const e=[],a=[[-1,0],[1,0],[0,1],[0,-1]];for(let h of a){const a=Math.floor(t._row+h[0]),c=Math.floor(t._col+h[1]);a>=0&&c>=0&&a<r&&c<n&&i.getTile(new s(a,c)).terrain.getIsPassable()&&e.push(new o(a,c))}return e}}(this._selectedChild.getPosition,n.getPosition,this._tiles,this._widthInTiles,this._heightInTiles);r&&(this._tiles.selectTiles(r),r.forEach((t=>this._selectedChild.moveToTile(t))))}update(t){this._tiles.update(t)}draw(t){t.clearRect(0,0,board.width,board.height),t.save(),t.translate(this._camera._x,this._camera._y),this.drawObjects(t),t.restore()}drawObjects(t){this._tiles.draw(t,this._selectedChild),this._children.forEach((e=>e.draw(t)))}displayScore(t){t.font="30px Arial",t.fillStyle="black",t.textAlign="center",t.textBaseline="middle";var e=`Score: ${this._score}`;t.fillText(e,(this._widthInTiles-1)*this._tileSize,this._tileSize/2)}}(Tt,wt,32,20);vt.generateMaze();const St=new class extends F{constructor(t,e){super(new f({resource:d.images.gnome,frameSize:new s(72,72),hFrames:9,vFrames:4}),{stayDownPattern:X,stayUpPattern:Z,stayLeftPattern:Y,stayRightPattern:q,walkDownPattern:G,walkUpPattern:J,walkLeftPattern:V,walkRightPattern:tt},t,75,75,e),this._sphere=new N(this._position.clone(),28,30)}throwObject(){let t=null;const e=.1;switch(this._currentDirection){case z:t=new s(e,0);break;case L:t=new s(-.1,0);break;case D:t=new s(0,-.1);break;case O:t=new s(0,e)}this._sphere.throwTowards(t),this.inventory.shift()}frame(t){super.frame(t),this._sphere.update(t),this._sphere.isThrown||this._sphere.setPosition(this._position)}draw(t){super.draw(t),(this.inventory.length>0||this._sphere.isThrown)&&this._sphere.draw(t,this._currentDirection)}}(new s(1,2),yt),bt=new class extends F{constructor(t,e){super(new f({resource:d.images.hero,frameSize:new s(74,75),hFrames:4,vFrames:4}),{stayUpPattern:W,stayDownPattern:U,stayLeftPattern:j,stayRightPattern:H,walkDownPattern:B,walkUpPattern:K,walkLeftPattern:Q,walkRightPattern:$},t,75,75,e),this._sphere=new N(this._position.clone(),28,30)}throwObject(){let t=null;const e=.1;switch(this._currentDirection){case z:t=new s(e,0);break;case L:t=new s(-.1,0);break;case D:t=new s(0,-.1);break;case O:t=new s(0,e)}this._sphere.throwTowards(t),this.inventory.shift()}frame(t){super.frame(t),this._sphere.update(t),this._sphere.isThrown||this._sphere.setPosition(this._position)}draw(t){super.draw(t),(this.inventory.length>0||this._sphere.isThrown)&&this._sphere.draw(t,this._currentDirection)}}(new s(1,5),yt);vt.appendChild(St),vt.appendChild(bt);new class{constructor(t,e){this.lastFrameTime=0,this.accumulatedTime=0,this.timeStep=1e3/60,this.update=t,this.render=e,this.rafId=null,this.isRunning=!1}mainLoop=t=>{if(!this.isRunning)return;let e=t-this.lastFrameTime;for(this.lastFrameTime=t,this.accumulatedTime+=e;this.accumulatedTime>=this.timeStep;)this.update(this.timeStep),this.accumulatedTime-=this.timeStep;this.render(),this.rafId=requestAnimationFrame(this.mainLoop)};start(){this.isRunning||(this.isRunning=!0,this.rafId=requestAnimationFrame(this.mainLoop))}stop(){this.rafId&&cancelAnimationFrame(this.rafId),this.isRunning=!1}}((t=>{vt.handleInputEvents(),vt.update(t),St.frame(t),bt.frame(t)}),(()=>{vt.draw(pt)})).start()})()})();