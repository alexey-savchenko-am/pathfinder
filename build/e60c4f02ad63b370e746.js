import{events}from"../../Events.js";import{resources}from"../../Resources.js";import{soundPlayer}from"../../SoundPlayer.js";import{GameObject}from"../GameObject.js";import{Vector2D}from"../Vector2D.js";import{Animation}from"../animation/Animation.js";import{ObjectInputHandler}from"../input/ObjectInputHandler.js";export const Direction={UP:"up",DOWN:"down",LEFT:"left",RIGHT:"right"};export class Hero extends GameObject{constructor(t,i,e,n,s,o){super(e,n,s,o),this._destinationQueue=[],this._isMoving=!1,this._sprite=t,this._patterns=i,this._animation=new Animation(t,i.stayDownPattern),this._prevPosition=e.clone(),this._currentDirection=Direction.DOWN,this._inventory=[],events.on("HERO_POSITION",this,(()=>{}))}pickUpItem(t){this._currentDirection=Direction.UP,this._inventory.push(t),soundPlayer.playSound(resources.sounds.pickup)}get inventory(){return this._inventory}moveToTile(t){this.moveTo(t.getCol*this._tileSize,t.getRow*this._tileSize)}cancelMoving(){this._isMoving=!1,this._destinationQueue=[]}moveTo(t,i){this._isMoving=!0,t=Math.floor(t/this._tileSize)*this._tileSize,i=Math.floor(i/this._tileSize)*this._tileSize;const e=this._destinationQueue.length>0?this._destinationQueue[this._destinationQueue.length-1]:{x:this._x,y:this._y},n=this.getDelta(e.x,e.y,t,i),s=Math.atan2(n.dy,n.dx),o=this.radiansToDirection(s);this._destinationQueue.push({x:t,y:i,angle:s,direction:o})}radiansToDirection(t){var i=t*(180/Math.PI);return i>=-45&&i<45?Direction.RIGHT:i>=45&&i<135?Direction.DOWN:i>=135&&i<=180||i>=-180&&i<-135?Direction.LEFT:i>=-135&&i<-45?Direction.UP:void 0}frame(t){if(this._animation.update(t),0===this._destinationQueue.length){switch(this._currentDirection){case Direction.DOWN:this._animation.setAnimationPattern(this._patterns.stayDownPattern);break;case Direction.UP:this._animation.setAnimationPattern(this._patterns.stayUpPattern);break;case Direction.LEFT:this._animation.setAnimationPattern(this._patterns.stayLeftPattern);break;case Direction.RIGHT:this._animation.setAnimationPattern(this._patterns.stayRightPattern)}return}events.emit("HERO_POSITION",this._position);let i=this._destinationQueue[0];switch(this._currentDirection=i.direction,i.direction){case Direction.DOWN:this._animation.setAnimationPattern(this._patterns.walkDownPattern);break;case Direction.UP:this._animation.setAnimationPattern(this._patterns.walkUpPattern);break;case Direction.LEFT:this._animation.setAnimationPattern(this._patterns.walkLeftPattern);break;case Direction.RIGHT:this._animation.setAnimationPattern(this._patterns.walkRightPattern)}const e=this.getDelta(this._x,this._y,i.x,i.y);if(Math.sqrt(e.dx*e.dx+e.dy*e.dy)<5)return this._destinationQueue.shift(),void(0===this._destinationQueue.length&&(this._isMoving=!1));const n=this._x+5*Math.cos(i.angle),s=this._y+5*Math.sin(i.angle);this._prevPosition=this._position.clone();const o=new Vector2D(s/this._tileSize,n/this._tileSize);this.setPosition(o),this._x=n,this._y=s}draw(t){this._animation.draw(t,this._centerX,this._centerY,this.width,this.height),this._selected&&(t.beginPath(),t.arc(this._x+this.width/2,this._y-5,5,0,2*Math.PI,!1),t.fillStyle="yellow",t.fill(),t.lineWidth=2,t.strokeStyle="black",t.stroke(),t.closePath())}}